{% extends 'base.html' %}

{% block title %}게시글 작성 - Instagram Clone{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="far fa-plus-square"></i> 새 게시글 작성
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- 이미지 업로드 영역 -->
                    <div class="mb-4">
                        <label for="images" class="form-label">
                            <i class="far fa-images"></i> 사진 업로드
                        </label>
                        <input type="file" 
                               class="form-control" 
                               id="images" 
                               name="images" 
                               multiple 
                               accept="image/*"
                               onchange="previewImages(this)">
                        <div class="form-text">여러 장의 사진을 선택할 수 있습니다.</div>
                        
                        <!-- 이미지 미리보기 영역 -->
                        <div id="imagePreview" class="mt-3"></div>
                    </div>

                    <!-- 게시글 내용 -->
                    <div class="mb-4">
                        <label for="content" class="form-label">
                            <i class="far fa-edit"></i> 게시글 내용
                        </label>
                        <textarea class="form-control" 
                                  id="content" 
                                  name="content" 
                                  rows="4" 
                                  placeholder="무슨 일이 일어나고 있나요?"
                                  required></textarea>
                        <div class="form-text">게시글 내용을 입력해주세요.</div>
                    </div>

                    <!-- 버튼 그룹 -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'instagram:home' %}" class="btn btn-outline-secondary me-md-2">
                            <i class="fas fa-times"></i> 취소
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> 게시하기
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
/**
 * 이미지 미리보기 기능
 * 사용자가 선택한 이미지들을 업로드 전에 미리 볼 수 있도록 함
 */
function previewImages(input) {
    const previewContainer = document.getElementById('imagePreview');
    previewContainer.innerHTML = '';  // 기존 미리보기 제거
    
    if (input.files && input.files.length > 0) {
        // 미리보기 컨테이너 생성
        const previewDiv = document.createElement('div');
        previewDiv.className = 'row g-2';
        
        // 선택된 각 파일에 대해 미리보기 생성
        Array.from(input.files).forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const colDiv = document.createElement('div');
                    colDiv.className = 'col-md-6 col-lg-4';
                    
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'position-relative';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'img-fluid rounded';
                    img.style.aspectRatio = '1';
                    img.style.objectFit = 'cover';
                    img.alt = `미리보기 ${index + 1}`;
                    
                    // 이미지 제거 버튼 (실제 구현시 필요)
                    const removeBtn = document.createElement('button');
                    removeBtn.type = 'button';
                    removeBtn.className = 'btn btn-sm btn-danger position-absolute top-0 end-0 m-1';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.style.zIndex = '10';
                    
                    imageContainer.appendChild(img);
                    imageContainer.appendChild(removeBtn);
                    colDiv.appendChild(imageContainer);
                    previewDiv.appendChild(colDiv);
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        previewContainer.appendChild(previewDiv);
        
        // 선택된 파일 수 표시
        const fileCountInfo = document.createElement('div');
        fileCountInfo.className = 'alert alert-info mt-2';
        fileCountInfo.innerHTML = `<i class="fas fa-info-circle"></i> ${input.files.length}개의 이미지가 선택되었습니다.`;
        previewContainer.appendChild(fileCountInfo);
    }
}
</script>
{% endblock %} 